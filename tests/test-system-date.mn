load test.case
load system.date

class DateTest : Test.Case {
	def testLeapYear(self) {
		self.expectEqual(false, System.Date.isLeap(1970))
		self.expectEqual(false, System.Date.isLeap(1971))
		self.expectEqual(true, System.Date.isLeap(1972))
		self.expectEqual(false, System.Date.isLeap(1973))
	}

	def testAddMonth(self) {
		self.expectDefined(System.TimeZone.current())
		date = System.Date(1970, 1, 1)
		self.expectDefined(date)
		self.expectEqual(1, date.getMonth())
		date = date.addMonths(5)
		self.expectEqual(6, date.getMonth())
		date = date.addMonths(6)
		self.expectEqual(12, date.getMonth())
		date = date.addMonths(1)
		self.expectEqual(1, date.getMonth())
		self.expectEqual(1971, date.getYear())
		date = date.addMonths(-30)
		self.expectEqual(7, date.getMonth())
		self.expectEqual(1968, date.getYear())
		date = date.addMonths(30)
		self.expectEqual(1, date.getMonth())
		self.expectEqual(1971, date.getYear())
	}

	def testParseIsoDate(self) {

		const SecondsPerDay = 86400

		self.expectEqual(18993, System.Date("2022").toSeconds() / SecondsPerDay)
		self.expectEqual(19052, System.Date("202203").toSeconds() / SecondsPerDay)
		self.expectEqual(19052, System.Date("2022-03").toSeconds() / SecondsPerDay)
		self.expectEqual(19068, System.Date("20220317").toSeconds() / SecondsPerDay)
		self.expectEqual(19068, System.Date("2022-03-17").toSeconds() / SecondsPerDay)
		self.expectEqual(19068, System.Date("2022W114").toSeconds() / SecondsPerDay)
		self.expectEqual(19068, System.Date("2022-W11-4").toSeconds() / SecondsPerDay)
		self.expectEqual(1647518400, System.Date("2022-03-17T12").toSeconds())
		self.expectEqual(1647518400, System.Date("2022-03-17T12Z").toSeconds())
		self.expectEqual(1647514800, System.Date("2022-03-17T12+0100").toSeconds())
		self.expectEqual(1647513000, System.Date("2022-03-17T12+0130").toSeconds())
		self.expectEqual(1647522000, System.Date("2022-03-17T12-0100").toSeconds())
		self.expectEqual(1647523800, System.Date("2022-03-17T12-0130").toSeconds())
		self.expectEqual(1647514800, System.Date("2022-03-17T12+01:00").toSeconds())
		self.expectEqual(1647513000, System.Date("2022-03-17T12+01:30").toSeconds())
		self.expectEqual(1647522000, System.Date("2022-03-17T12-01:00").toSeconds())
		self.expectEqual(1647523800, System.Date("2022-03-17T12-01:30").toSeconds())
		self.expectEqual(1647520200, System.Date("2022-03-17T1230").toSeconds())
		self.expectEqual(1647520200, System.Date("2022-03-17T1230Z").toSeconds())
		self.expectEqual(1647516600, System.Date("2022-03-17T1230+0100").toSeconds())
		self.expectEqual(1647514800, System.Date("2022-03-17T1230+0130").toSeconds())
		self.expectEqual(1647523800, System.Date("2022-03-17T1230-0100").toSeconds())
		self.expectEqual(1647525600, System.Date("2022-03-17T1230-0130").toSeconds())
		self.expectEqual(1647516600, System.Date("2022-03-17T1230+01:00").toSeconds())
		self.expectEqual(1647514800, System.Date("2022-03-17T1230+01:30").toSeconds())
		self.expectEqual(1647523800, System.Date("2022-03-17T1230-01:00").toSeconds())
		self.expectEqual(1647525600, System.Date("2022-03-17T1230-01:30").toSeconds())
		self.expectEqual(1647520200, System.Date("2022-03-17T12:30").toSeconds())
		self.expectEqual(1647520200, System.Date("2022-03-17T12:30Z").toSeconds())
		self.expectEqual(1647516600, System.Date("2022-03-17T12:30+0100").toSeconds())
		self.expectEqual(1647514800, System.Date("2022-03-17T12:30+0130").toSeconds())
		self.expectEqual(1647523800, System.Date("2022-03-17T12:30-0100").toSeconds())
		self.expectEqual(1647525600, System.Date("2022-03-17T12:30-0130").toSeconds())
		self.expectEqual(1647516600, System.Date("2022-03-17T12:30+01:00").toSeconds())
		self.expectEqual(1647514800, System.Date("2022-03-17T12:30+01:30").toSeconds())
		self.expectEqual(1647523800, System.Date("2022-03-17T12:30-01:00").toSeconds())
		self.expectEqual(1647525600, System.Date("2022-03-17T12:30-01:30").toSeconds())
		self.expectEqual(1647520255, System.Date("2022-03-17T123055").toSeconds())
		self.expectEqual(1647520255, System.Date("2022-03-17T123055Z").toSeconds())
		self.expectEqual(1647516655, System.Date("2022-03-17T123055+0100").toSeconds())
		self.expectEqual(1647514855, System.Date("2022-03-17T123055+0130").toSeconds())
		self.expectEqual(1647523855, System.Date("2022-03-17T123055-0100").toSeconds())
		self.expectEqual(1647525655, System.Date("2022-03-17T123055-0130").toSeconds())
		self.expectEqual(1647516655, System.Date("2022-03-17T123055+01:00").toSeconds())
		self.expectEqual(1647514855, System.Date("2022-03-17T123055+01:30").toSeconds())
		self.expectEqual(1647523855, System.Date("2022-03-17T123055-01:00").toSeconds())
		self.expectEqual(1647525655, System.Date("2022-03-17T123055-01:30").toSeconds())
		self.expectEqual(1647520255, System.Date("2022-03-17T12:30:55").toSeconds())
		self.expectEqual(1647520255, System.Date("2022-03-17T12:30:55Z").toSeconds())
		self.expectEqual(1647516655, System.Date("2022-03-17T12:30:55+0100").toSeconds())
		self.expectEqual(1647514855, System.Date("2022-03-17T12:30:55+0130").toSeconds())
		self.expectEqual(1647523855, System.Date("2022-03-17T12:30:55-0100").toSeconds())
		self.expectEqual(1647525655, System.Date("2022-03-17T12:30:55-0130").toSeconds())
		self.expectEqual(1647516655, System.Date("2022-03-17T12:30:55+01:00").toSeconds())
		self.expectEqual(1647514855, System.Date("2022-03-17T12:30:55+01:30").toSeconds())
		self.expectEqual(1647523855, System.Date("2022-03-17T12:30:55-01:00").toSeconds())
		self.expectEqual(1647525655, System.Date("2022-03-17T12:30:55-01:30").toSeconds())
		self.expectEqual(1647520255, System.Date("2022-03-17T12:30:55.25").toSeconds())
		self.expectEqual(250, System.Date("2022-03-17T12:30:55.25").getMilliseconds())
		self.expectEqual(1647520255, System.Date("2022-03-17T12:30:55.25Z").toSeconds())
		self.expectEqual(1647516655, System.Date("2022-03-17T12:30:55.25+0100").toSeconds())
		self.expectEqual(1647514855, System.Date("2022-03-17T12:30:55.25+0130").toSeconds())
		self.expectEqual(1647523855, System.Date("2022-03-17T12:30:55.25-0100").toSeconds())
		self.expectEqual(1647525655, System.Date("2022-03-17T12:30:55.25-0130").toSeconds())
		self.expectEqual(1647516655, System.Date("2022-03-17T12:30:55.25+01:00").toSeconds())
		self.expectEqual(1647514855, System.Date("2022-03-17T12:30:55.25+01:30").toSeconds())
		self.expectEqual(1647523855, System.Date("2022-03-17T12:30:55.25-01:00").toSeconds())
		self.expectEqual(1647525655, System.Date("2022-03-17T12:30:55.25-01:30").toSeconds())
		self.expectEqual(250, System.Date("2022-03-17T12:30:55.25Z").getMilliseconds())
		self.expectEqual(1647520255, System.Date("2022-03-17T12:30:55.25753").toSeconds())
		self.expectEqual(257, System.Date("2022-03-17T12:30:55.25753").getMilliseconds())
		self.expectEqual(1647520255, System.Date("2022-03-17T12:30:55.25753Z").toSeconds())
		self.expectEqual(1647516655, System.Date("2022-03-17T12:30:55.25753+0100").toSeconds())
		self.expectEqual(1647514855, System.Date("2022-03-17T12:30:55.25753+0130").toSeconds())
		self.expectEqual(1647523855, System.Date("2022-03-17T12:30:55.25753-0100").toSeconds())
		self.expectEqual(1647525655, System.Date("2022-03-17T12:30:55.25753-0130").toSeconds())
		self.expectEqual(1647516655, System.Date("2022-03-17T12:30:55.25753+01:00").toSeconds())
		self.expectEqual(1647514855, System.Date("2022-03-17T12:30:55.25753+01:30").toSeconds())
		self.expectEqual(1647523855, System.Date("2022-03-17T12:30:55.25753-01:00").toSeconds())
		self.expectEqual(1647525655, System.Date("2022-03-17T12:30:55.25753-01:30").toSeconds())
		self.expectEqual(257, System.Date("2022-03-17T12:30:55.25753Z").getMilliseconds())
		self.expectEqual(43200, System.Date("T12").toSeconds() % SecondsPerDay)
		self.expectEqual(43200, System.Date("T12Z").toSeconds() % SecondsPerDay)
		self.expectEqual(39600, System.Date("T12+0100").toSeconds() % SecondsPerDay)
		self.expectEqual(37800, System.Date("T12+0130").toSeconds() % SecondsPerDay)
		self.expectEqual(46800, System.Date("T12-0100").toSeconds() % SecondsPerDay)
		self.expectEqual(48600, System.Date("T12-0130").toSeconds() % SecondsPerDay)
		self.expectEqual(39600, System.Date("T12+01:00").toSeconds() % SecondsPerDay)
		self.expectEqual(37800, System.Date("T12+01:30").toSeconds() % SecondsPerDay)
		self.expectEqual(46800, System.Date("T12-01:00").toSeconds() % SecondsPerDay)
		self.expectEqual(48600, System.Date("T12-01:30").toSeconds() % SecondsPerDay)
		self.expectEqual(45000, System.Date("T1230").toSeconds() % SecondsPerDay)
		self.expectEqual(45000, System.Date("T1230Z").toSeconds() % SecondsPerDay)
		self.expectEqual(41400, System.Date("T1230+0100").toSeconds() % SecondsPerDay)
		self.expectEqual(39600, System.Date("T1230+0130").toSeconds() % SecondsPerDay)
		self.expectEqual(48600, System.Date("T1230-0100").toSeconds() % SecondsPerDay)
		self.expectEqual(50400, System.Date("T1230-0130").toSeconds() % SecondsPerDay)
		self.expectEqual(41400, System.Date("T1230+01:00").toSeconds() % SecondsPerDay)
		self.expectEqual(39600, System.Date("T1230+01:30").toSeconds() % SecondsPerDay)
		self.expectEqual(48600, System.Date("T1230-01:00").toSeconds() % SecondsPerDay)
		self.expectEqual(50400, System.Date("T1230-01:30").toSeconds() % SecondsPerDay)
		self.expectEqual(45000, System.Date("12:30").toSeconds() % SecondsPerDay)
		self.expectEqual(45000, System.Date("T12:30").toSeconds() % SecondsPerDay)
		self.expectEqual(45000, System.Date("T12:30Z").toSeconds() % SecondsPerDay)
		self.expectEqual(41400, System.Date("T12:30+0100").toSeconds() % SecondsPerDay)
		self.expectEqual(39600, System.Date("T12:30+0130").toSeconds() % SecondsPerDay)
		self.expectEqual(48600, System.Date("T12:30-0100").toSeconds() % SecondsPerDay)
		self.expectEqual(50400, System.Date("T12:30-0130").toSeconds() % SecondsPerDay)
		self.expectEqual(41400, System.Date("T12:30+01:00").toSeconds() % SecondsPerDay)
		self.expectEqual(39600, System.Date("T12:30+01:30").toSeconds() % SecondsPerDay)
		self.expectEqual(48600, System.Date("T12:30-01:00").toSeconds() % SecondsPerDay)
		self.expectEqual(50400, System.Date("T12:30-01:30").toSeconds() % SecondsPerDay)
		self.expectEqual(45055, System.Date("T123055").toSeconds() % SecondsPerDay)
		self.expectEqual(45055, System.Date("T123055Z").toSeconds() % SecondsPerDay)
		self.expectEqual(41455, System.Date("T123055+0100").toSeconds() % SecondsPerDay)
		self.expectEqual(39655, System.Date("T123055+0130").toSeconds() % SecondsPerDay)
		self.expectEqual(48655, System.Date("T123055-0100").toSeconds() % SecondsPerDay)
		self.expectEqual(50455, System.Date("T123055-0130").toSeconds() % SecondsPerDay)
		self.expectEqual(41455, System.Date("T123055+01:00").toSeconds() % SecondsPerDay)
		self.expectEqual(39655, System.Date("T123055+01:30").toSeconds() % SecondsPerDay)
		self.expectEqual(48655, System.Date("T123055-01:00").toSeconds() % SecondsPerDay)
		self.expectEqual(50455, System.Date("T123055-01:30").toSeconds() % SecondsPerDay)
		self.expectEqual(45055, System.Date("12:30:55").toSeconds() % SecondsPerDay)
		self.expectEqual(45055, System.Date("T12:30:55").toSeconds() % SecondsPerDay)
		self.expectEqual(45055, System.Date("T12:30:55Z").toSeconds() % SecondsPerDay)
		self.expectEqual(45055, System.Date("T12:30:55").toSeconds() % SecondsPerDay)
		self.expectEqual(45055, System.Date("T12:30:55Z").toSeconds() % SecondsPerDay)
		self.expectEqual(41455, System.Date("T12:30:55+0100").toSeconds() % SecondsPerDay)
		self.expectEqual(39655, System.Date("T12:30:55+0130").toSeconds() % SecondsPerDay)
		self.expectEqual(48655, System.Date("T12:30:55-0100").toSeconds() % SecondsPerDay)
		self.expectEqual(50455, System.Date("T12:30:55-0130").toSeconds() % SecondsPerDay)
		self.expectEqual(41455, System.Date("T12:30:55+01:00").toSeconds() % SecondsPerDay)
		self.expectEqual(39655, System.Date("T12:30:55+01:30").toSeconds() % SecondsPerDay)
		self.expectEqual(48655, System.Date("T12:30:55-01:00").toSeconds() % SecondsPerDay)
		self.expectEqual(50455, System.Date("T12:30:55-01:30").toSeconds() % SecondsPerDay)
		self.expectEqual(45055, System.Date("T12:30:55.25").toSeconds() % SecondsPerDay)
		self.expectEqual(250, System.Date("T12:30:55.25").getMilliseconds())
		self.expectEqual(45055, System.Date("T12:30:55.25Z").toSeconds() % SecondsPerDay)
		self.expectEqual(41455, System.Date("T12:30:55.25+0100").toSeconds() % SecondsPerDay)
		self.expectEqual(39655, System.Date("T12:30:55.25+0130").toSeconds() % SecondsPerDay)
		self.expectEqual(48655, System.Date("T12:30:55.25-0100").toSeconds() % SecondsPerDay)
		self.expectEqual(50455, System.Date("T12:30:55.25-0130").toSeconds() % SecondsPerDay)
		self.expectEqual(41455, System.Date("T12:30:55.25+01:00").toSeconds() % SecondsPerDay)
		self.expectEqual(39655, System.Date("T12:30:55.25+01:30").toSeconds() % SecondsPerDay)
		self.expectEqual(48655, System.Date("T12:30:55.25-01:00").toSeconds() % SecondsPerDay)
		self.expectEqual(50455, System.Date("T12:30:55.25-01:30").toSeconds() % SecondsPerDay)
		self.expectEqual(250, System.Date("T12:30:55.25Z").getMilliseconds())
		self.expectEqual(45055, System.Date("T12:30:55.25753").toSeconds() % SecondsPerDay)
		self.expectEqual(257, System.Date("T12:30:55.25753").getMilliseconds())
		self.expectEqual(45055, System.Date("2022-03-17T12:30:55.25753Z").toSeconds() % SecondsPerDay)
		self.expectEqual(257, System.Date("T12:30:55.25753Z").getMilliseconds())
		self.expectEqual(41455, System.Date("T12:30:55.25753+0100").toSeconds() % SecondsPerDay)
		self.expectEqual(39655, System.Date("T12:30:55.25753+0130").toSeconds() % SecondsPerDay)
		self.expectEqual(48655, System.Date("T12:30:55.25753-0100").toSeconds() % SecondsPerDay)
		self.expectEqual(50455, System.Date("T12:30:55.25753-0130").toSeconds() % SecondsPerDay)
		self.expectEqual(41455, System.Date("T12:30:55.25753+01:00").toSeconds() % SecondsPerDay)
		self.expectEqual(39655, System.Date("T12:30:55.25753+01:30").toSeconds() % SecondsPerDay)
		self.expectEqual(48655, System.Date("T12:30:55.25753-01:00").toSeconds() % SecondsPerDay)
		self.expectEqual(50455, System.Date("T12:30:55.25753-01:30").toSeconds() % SecondsPerDay)
	}
}
